<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 2rem;
      }
      h1 {
        color: gold;
        margin-bottom: 1rem;
      }
      input,
      select,
      textarea,
      button {
        margin: 0.5rem 0;
        padding: 0.5rem;
        font-size: 1rem;
        width: 100%;
        border-radius: 5px;
        border: none;
      }
      button {
        cursor: pointer;
        background: gold;
        color: #111;
        font-weight: bold;
        transition: 0.2s;
      }
      button:hover {
        background: #ffd700cc;
      }
      .dashboard-card {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 2rem;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
      }
      .dashboard-card h2 {
        color: gold;
        margin-top: 0;
      }
      .table-wrapper {
        max-height: 300px;
        overflow-y: auto;
        border-radius: 10px;
        border: 1px solid rgba(255, 215, 0, 0.3);
        margin-top: 1rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        padding: 8px 10px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      th {
        background: rgba(255, 215, 0, 0.1);
        color: gold;
        position: sticky;
        top: 0;
      }
      tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.03);
      }
      table button {
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        width: auto;
      }
      #logoutBtn,
      #mainPageBtn {
        margin-right: 1rem;
        margin-bottom: 1rem;
      }
      #detailModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        justify-content: center;
        align-items: center;
      }
      #detailModal .modal-content {
        background: #222;
        padding: 1.5rem;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
      }
      #detailModal h3 {
        margin-top: 0;
        color: gold;
      }
      #closeModal {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: gold;
        border: none;
        color: #111;
        cursor: pointer;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>
    <button id="mainPageBtn" onclick="location.href='workouts.html'">
      Main Page
    </button>

    <!-- Add Workout Card -->
    <div class="dashboard-card">
      <h2>Add Workout</h2>
      <label>Day:</label>
      <select id="day">
        <option>MONDAY</option>
        <option>TUESDAY</option>
        <option>WEDNESDAY</option>
        <option>THURSDAY</option>
        <option>FRIDAY</option>
        <option>SATURDAY</option>
        <option>SUNDAY</option>
      </select>
      <label>Workout Name:</label>
      <select id="name">
        <option>ELEV8 RUN CLUB</option>
        <option>HYROX SATURDAY</option>
        <option>LONG RUN</option>
        <option>ZONE 2</option>
        <option>THRESHOLD RUN</option>
        <option>STRENGTH TRAINING</option>
        <option>RECOVERY RUN</option>
        <option>CONDITIONING</option>
        <option>BIKE ERG</option>
      </select>
      <label>Time:</label>
      <select id="time">
        <option>MORNING â€“ BEFORE SCHOOL</option>
        <option>EVENING â€“ AFTER SCHOOL</option>
        <option>ANY TIME â€“ WEEKEND</option>
      </select>
      <label>Encouragement:</label>
      <select id="encouragement">
        <option>YOU GOT THIS!</option>
        <option>KEEP IT UP!</option>
        <option>IT'S EASY!</option>
        <option>FEEL THE BURN!</option>
        <option>NO PAIN NO GAIN!</option>
        <option>CRUSH IT!</option>
        <option>LETS GO!</option>
      </select>
      <label>Details:</label>
      <textarea
        id="workoutDetails"
        placeholder="Paste or type workout here..."
      ></textarea>
      <button id="addBtn">Add Workout</button>
    </div>

    <!-- Workouts Table -->
    <div class="dashboard-card">
      <h2>Workouts</h2>
      <div class="table-wrapper">
        <table id="workoutTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Name</th>
              <th>Time</th>
              <th>Encouragement</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- History Table -->
    <div class="dashboard-card">
      <h2>Completed Workouts</h2>
      <div class="table-wrapper">
        <table id="historyTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Name</th>
              <th>Day</th>
              <th>Time</th>
              <th>Duration</th>
              <th>Action</th>
              <th>Remove</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Modal for More Details -->
    <div id="detailModal">
      <div class="modal-content">
        <h3 id="modalWorkoutName">Workout</h3>
        <div id="modalExercises"></div>
        <button id="closeModal">Close</button>
      </div>
    </div>

   <script>
(() => {
  // --- WORKOUTS ---
  let workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
  const tableBody = document.querySelector("#workoutTable tbody");
  const workoutDetailsEl = document.getElementById("workoutDetails");
  const addBtn = document.getElementById("addBtn");

  function cleanWorkout(details) {
    return details
      .split("\n")
      .filter((l) => l.trim())
      .map((line) => {
        line = line.trim();
        let match = line.match(/(\d+)\s*[x*]\s*(\d+)/i);
        let sets = match ? match[1] : "";
        let reps = match ? match[2] : "";
        let weightMatch = line.match(/(\d+)\s*(kg|lb|lbs)/i);
        let weight = weightMatch ? weightMatch[0] : "";
        let cleanLine = line
          .replace(/(\d+\s*[x*]\s*\d+)/i, "")
          .replace(/(\d+\s*(kg|lb|lbs))/i, "")
          .trim();
        if (sets && reps)
          return (
            cleanLine +
            " â€” " +
            sets +
            " x " +
            reps +
            (weight ? " @ " + weight : "")
          );
        return cleanLine;
      })
      .filter((l) => l)
      .join("\n");
  }

  function renderWorkouts() {
    tableBody.innerHTML = "";
    if (workouts.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML =
        '<td colspan="5" style="text-align:center; color:#888;">No workouts yet.</td>';
      tableBody.appendChild(tr);
      return;
    }
    workouts.forEach((w, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${w.day}</td><td>${w.name}</td><td>${w.time}</td><td>${w.encouragement}</td><td><button class="remove-workout-btn" data-index="${i}">Remove</button></td>`;
      tableBody.appendChild(tr);
    });
  }

  addBtn.addEventListener("click", () => {
    const day = document.getElementById("day").value;
    const name = document.getElementById("name").value.trim();
    const time = document.getElementById("time").value.trim();
    const encouragement = document
      .getElementById("encouragement")
      .value.trim();
    const details = workoutDetailsEl.value.trim();
    if (!day || !name || !time || !encouragement)
      return alert("Fill all fields!");
    const formattedDetails = cleanWorkout(details);
    workouts.push({
      day,
      name,
      time,
      encouragement,
      details: formattedDetails,
      type: "Auto",
    });
    localStorage.setItem("workouts", JSON.stringify(workouts));
    workoutDetailsEl.value = "";
    renderWorkouts();
  });

  tableBody.addEventListener("click", (e) => {
    if (!e.target.classList.contains("remove-workout-btn")) return;
    const index = parseInt(e.target.dataset.index);
    workouts.splice(index, 1);
    localStorage.setItem("workouts", JSON.stringify(workouts));
    renderWorkouts();
  });

  renderWorkouts(); // ðŸ‘ˆ always render on page load
})();

// --- HISTORY ---
(() => {
  const historyTable = document.querySelector("#historyTable tbody");
  const detailModal = document.getElementById("detailModal");
  const modalWorkoutName = document.getElementById("modalWorkoutName");
  const modalExercises = document.getElementById("modalExercises");
  const closeModal = document.getElementById("closeModal");

  let completedWorkouts = JSON.parse(
    localStorage.getItem("completedWorkouts") || "[]"
  );

  function renderHistory() {
    historyTable.innerHTML = "";
    if (completedWorkouts.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML =
        '<td colspan="7" style="text-align:center; color:#888;">No completed workouts yet.</td>';
      historyTable.appendChild(tr);
      return;
    }
    completedWorkouts.forEach((w, i) => {
      const durationMin = Math.floor((w.duration || 0) / 60);
      const durationSec = (w.duration || 0) % 60;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${new Date(
        w.date
      ).toLocaleDateString()}</td><td>${w.name}</td><td>${w.day}</td><td>${
        w.time
      }</td><td>${durationMin}m ${durationSec}s</td><td><button class="detail-btn" data-index="${i}">More Details</button></td><td><button class="remove-btn" data-index="${i}">Remove</button></td>`;
      historyTable.appendChild(tr);
    });
  }

  historyTable.addEventListener("click", (e) => {
    const btn = e.target;
    if (btn.classList.contains("detail-btn")) {
      const workout = completedWorkouts[btn.dataset.index];
      modalWorkoutName.textContent = workout.name;
      modalExercises.innerHTML = "";
      const scrollContainer = document.createElement("div");
      scrollContainer.style.maxHeight = "300px";
      scrollContainer.style.overflowY = "auto";
      scrollContainer.style.marginTop = "8px";

      const exTable = document.createElement("table");
      exTable.style.width = "100%";
      exTable.style.borderCollapse = "collapse";
      const thead = document.createElement("thead");
      thead.innerHTML = `<tr><th style="border-bottom:1px solid gold;padding:4px;">Exercise</th><th style="border-bottom:1px solid gold;padding:4px;">Sets</th><th style="border-bottom:1px solid gold;padding:4px;">Reps</th><th style="border-bottom:1px solid gold;padding:4px;">Weight</th></tr>`;
      exTable.appendChild(thead);
      const tbody = document.createElement("tbody");
      workout.exercises.forEach((ex) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td style="padding:4px;">${
          ex.name
        }</td><td style="padding:4px;">${ex.sets || "-"}</td><td style="padding:4px;">${
          ex.reps || "-"
        }</td><td style="padding:4px;">${ex.weight || "-"}</td>`;
        tbody.appendChild(tr);
      });
      exTable.appendChild(tbody);
      scrollContainer.appendChild(exTable);
      modalExercises.appendChild(scrollContainer);
      detailModal.style.display = "flex";
    }

    if (btn.classList.contains("remove-btn")) {
      const index = parseInt(btn.dataset.index);
      if (!confirm("Remove this completed workout?")) return;
      completedWorkouts.splice(index, 1);
      localStorage.setItem(
        "completedWorkouts",
        JSON.stringify(completedWorkouts)
      );
      renderHistory();
    }
  });

  closeModal.addEventListener("click", () => {
    detailModal.style.display = "none";
  });

  renderHistory(); // ðŸ‘ˆ always render on page load
})();
</script>

  </body>
</html>


