<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Smart Workout Scheduler</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 2rem;
      }
      h1 {
        color: gold;
        margin-bottom: 1rem;
      }
      input,
      select,
      button {
        margin: 0.5rem 0;
        padding: 0.5rem;
        font-size: 1rem;
        width: 100%;
        border-radius: 5px;
        border: none;
      }
      button {
        cursor: pointer;
        background: gold;
        color: #111;
        font-weight: bold;
        transition: 0.2s;
      }
      button:hover {
        background: #ffd700cc;
      }
      .dashboard-card {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 2rem;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
      }
      .dashboard-card h2 {
        color: gold;
        margin-top: 0;
      }
      .table-wrapper {
        max-height: 300px;
        overflow-y: auto;
        border-radius: 10px;
        border: 1px solid rgba(255, 215, 0, 0.3);
        margin-top: 1rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        padding: 8px 10px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      th {
        background: rgba(255, 215, 0, 0.1);
        color: gold;
        position: sticky;
        top: 0;
      }
      tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.03);
      }
      table button {
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        width: auto;
      }

      .textarea-container {
        position: relative;
        width: 100%;
      }
      #workoutDetails {
        position: relative;
        z-index: 2;
        background: #1a1a1a;
        color: #fff;
        width: 100%;
        min-height: 200px;
        resize: vertical;
        line-height: 1.4;
        padding: 10px;
        caret-color: gold;
        font-family: inherit;
        white-space: pre-wrap;
        overflow-wrap: break-word;
        border: none;
        border-radius: 5px;
        font-size: 16px;
      }
      .ghost-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        pointer-events: none;
        z-index: 1;
        padding: 10px;
        line-height: 1.4;
        font-family: inherit;
        white-space: pre-wrap;
        overflow-wrap: break-word;
        font-size: 16px;
        color: rgba(255, 255, 255, 0.25);
        user-select: none;
      }
      .template-buttons {
        display: flex;
        gap: 8px;
        margin: 0.5rem 0 1rem;
        flex-wrap: wrap;
      }
      .template-btn {
        background: #222;
        color: #aaa;
        border: 1px dashed #444;
        border-radius: 6px;
        padding: 6px 10px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: 0.2s;
      }
      .template-btn:hover {
        background: #333;
        color: gold;
        border-color: gold;
      }
      .template-btn.active {
        background: gold;
        color: #111;
        border: 1px solid gold;
      }

      .suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        background: #222;
        border: 1px solid gold;
        width: 100%;
        z-index: 3;
        max-height: 200px;
        overflow-y: auto;
        border-radius: 5px;
        margin-top: 2px;
        display: none;
      }
      .suggestions div {
        padding: 5px 10px;
        cursor: pointer;
      }
      .suggestions div:hover {
        background: gold;
        color: #111;
      }
    </style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>

    <button onclick="location.href='workouts.html'">Go to Main Page</button>
    <button onclick="location.href='history.html'">History</button>

    <div class="dashboard-card">
      <h2>Add Workout</h2>

      <label>Day:</label>
      <select id="day">
        <option>MONDAY</option>
        <option>TUESDAY</option>
        <option>WEDNESDAY</option>
        <option>THURSDAY</option>
        <option>FRIDAY</option>
        <option>SATURDAY</option>
        <option>SUNDAY</option>
      </select>

      <label>Workout Name:</label>
      <select id="name">
        <option>ELEV8 RUN CLUB</option>
        <option>HYROX SATURDAY</option>
        <option>LONG RUN</option>
        <option>ZONE 2</option>
        <option>THRESHOLD RUN</option>
        <option>STRENGTH TRAINING</option>
        <option>RECOVERY RUN</option>
        <option>CONDITIONING</option>
        <option>BIKE ERG</option>
      </select>

      <label>Time:</label>
      <select id="time">
        <option>MORNING – BEFORE SCHOOL</option>
        <option>EVENING – AFTER SCHOOL</option>
        <option>ANY TIME – WEEKEND</option>
      </select>

      <label>Encouragement:</label>
      <select id="encouragement">
        <option>YOU GOT THIS!</option>
        <option>KEEP IT UP!</option>
        <option>IT'S EASY!</option>
        <option>FEEL THE BURN!</option>
        <option>NO PAIN NO GAIN!</option>
        <option>CRUSH IT!</option>
        <option>LETS GO!</option>
      </select>

      <label>Workout Details:</label>
      <div class="textarea-container">
        <div id="ghostText" class="ghost-overlay"></div>
        <textarea
          id="workoutDetails"
          placeholder="Paste or type workout here..."
        ></textarea>
        <div id="suggestBox" class="suggestions"></div>
      </div>

      <div class="template-buttons">
        <button
          class="template-btn"
          data-example="EMOM Bench Press  60s , 5 rounds"
        >
          EMOM
        </button>
        <button class="template-btn" data-example="AMRAP">AMRAP</button>
      </div>

      <button id="addBtn">Add Workout</button>
    </div>

    <div class="dashboard-card">
      <h2>Workouts</h2>
      <div class="table-wrapper">
        <table id="workoutTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Name</th>
              <th>Time</th>
              <th>Encouragement</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      const textarea = document.getElementById("workoutDetails");
      const ghostDiv = document.getElementById("ghostText");
      const suggestBox = document.getElementById("suggestBox");
      let ghostText = "";

      // Syntax highlight
      function highlightSyntax(text) {
        return text
          .replace(
            /(EMOM)/gi,
            '<span style="color:#ffbf00;font-weight:bold;">$1</span>'
          )
          .replace(
            /(AMRAP)/gi,
            '<span style="color:#ff8000;font-weight:bold;">$1</span>'
          )
          .replace(/\b(\d+)\b/g, '<span style="color:#00ffff;">$1</span>');
      }

      function updateGhost() {
        const typed = textarea.value;
        let display = "";
        for (let i = 0; i < ghostText.length; i++) {
          display += typed[i] === ghostText[i] ? "" : ghostText[i];
        }
        ghostDiv.innerHTML = highlightSyntax(display);
      }

      function insertTextAtCursor(text) {
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        textarea.value =
          textarea.value.slice(0, start) + text + textarea.value.slice(end);
        textarea.selectionStart = textarea.selectionEnd = start + text.length;
        textarea.focus();
        updateGhost();
      }

      // Templates
      document.querySelectorAll(".template-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          if (btn.id === "autoGenerateBtn") generateFullWorkout();
          else insertTextAtCursor("\n" + btn.dataset.example + "\n");
        });
      });

      // Exercise library
      const exerciseLibrary = [
        "Bench Press",
        "Incline Bench Press",
        "Decline Bench Press",
        "Squat",
        "Front Squat",
        "Overhead Squat",
        "Deadlift",
        "Romanian Deadlift",
        "Pull-ups",
        "Chin-ups",
        "Lat Pulldown",
        "Barbell Row",
        "Dumbbell Row",
        "Pushups",
        "Dips",
        "Plank",
        "Side Plank",
        "Hanging Leg Raise",
        "Bicep Curl",
        "Hammer Curl",
        "Tricep Extension",
        "Shoulder Press",
        "Lateral Raise",
        "Burpees",
        "Mountain Climbers",
        "Jumping Jacks",
        "Box Jumps",
        "Rowing",
        "Bike Erg",
        "Running",
        "Sprints",
        "Lunges",
        "Walking Lunges",
        "Glute Bridge",
        "Hip Thrust",
        "Leg Press",
        "Calf Raise",
        "Farmer's Carry",
        "Chest Fly",
        "Arnold Press",
        "Goblet Squat",
        "TRX Row",
      ];

      function getExerciseSuggestions(input) {
        const lastWord = input.split(/\s+/).pop().toLowerCase();
        if (!lastWord) return [];
        return exerciseLibrary
          .filter((ex) => ex.toLowerCase().includes(lastWord))
          .slice(0, 7);
      }

      function getAIWorkoutSuggestions(input) {
        const workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
        let freqMap = {};
        workouts.forEach((w) =>
          w.details.split("\n").forEach((line) => {
            const clean = line.trim();
            if (clean.length > 0) freqMap[clean] = (freqMap[clean] || 0) + 1;
          })
        );
        const lastWord = input.split(/\s+/).pop().toLowerCase();
        let suggestions = Object.keys(freqMap).filter((ex) =>
          ex.toLowerCase().includes(lastWord)
        );
        suggestions.sort((a, b) => freqMap[b] - freqMap[a]);
        return suggestions.slice(0, 5);
      }

      textarea.addEventListener("input", () => {
        updateGhost();
        const typed = textarea.value;
        const combined = [
          ...new Set([
            ...getExerciseSuggestions(typed),
            ...getAIWorkoutSuggestions(typed),
          ]),
        ].slice(0, 5);
        suggestBox.style.display = combined.length ? "block" : "none";
        suggestBox.innerHTML = combined.map((s) => `<div>${s}</div>`).join("");
      });

      suggestBox.addEventListener("click", (e) => {
        if (e.target.tagName === "DIV") {
          insertTextAtCursor(e.target.textContent + " ");
          suggestBox.style.display = "none";
        }
      });

      document.addEventListener("click", (e) => {
        if (!textarea.contains(e.target) && !suggestBox.contains(e.target))
          suggestBox.style.display = "none";
      });

      textarea.addEventListener("keyup", (e) => {
        if ([" ", "Enter", "Escape"].includes(e.key))
          suggestBox.style.display = "none";
      });

      function generateFullWorkout() {
        const workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
        if (workouts.length === 0) {
          insertTextAtCursor(
            "EMOM Example:\nPushups – 10 reps\nSquats – 15 reps\nPlank – 60s\n"
          );
          return;
        }
        let lines = [];
        workouts.forEach((w) =>
          w.details.split("\n").forEach((l) => {
            if (l.trim()) lines.push(l.trim());
          })
        );
        let shuffled = lines.sort(() => 0.5 - Math.random());
        insertTextAtCursor("\n" + shuffled.slice(0, 6).join("\n") + "\n");
      }

      (() => {
        let workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
        const tbody = document.querySelector("#workoutTable tbody");
        const addBtn = document.getElementById("addBtn");

        function render() {
          tbody.innerHTML =
            workouts.length === 0
              ? '<tr><td colspan="5" style="text-align:center;color:#888;">No workouts yet.</td></tr>'
              : workouts
                  .map(
                    (w, i) =>
                      `<tr><td>${w.day}</td><td>${w.name}</td><td>${w.time}</td><td>${w.encouragement}</td><td><button data-index="${i}" class="remove-btn">Remove</button></td></tr>`
                  )
                  .join("");
        }

        addBtn.addEventListener("click", () => {
          const day = document.getElementById("day").value;
          const name = document.getElementById("name").value.trim();
          const time = document.getElementById("time").value.trim();
          const encouragement = document
            .getElementById("encouragement")
            .value.trim();
          const details = textarea.value.trim();
          if (!day || !name || !time || !encouragement || !details)
            return alert("Please fill all fields!");
          workouts.push({ day, name, time, encouragement, details });
          localStorage.setItem("workouts", JSON.stringify(workouts));
          textarea.value = "";
          ghostText = "";
          updateGhost();
          render();
        });

        tbody.addEventListener("click", (e) => {
          if (e.target.classList.contains("remove-btn")) {
            workouts.splice(e.target.dataset.index, 1);
            localStorage.setItem("workouts", JSON.stringify(workouts));
            render();
          }
        });

        render();
      })();
    </script>
  </body>
</html>
